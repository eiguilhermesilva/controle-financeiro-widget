<!DOCTYPE html>
<html lang="pt-BR">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Controle Financeiro Completo</title>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/html2canvas/1.4.1/html2canvas.min.js"></script>
    <script src="https://cdn.jsdelivr.net/npm/chart.js"></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/jspdf/2.5.1/jspdf.umd.min.js"></script>
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css">
    <style>
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
            font-family: 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif;
        }
        
        body {
            background: linear-gradient(135deg, #1a2a6c, #b21f1f, #fdbb2d);
            display: flex;
            justify-content: center;
            align-items: flex-start;
            padding: 20px;
            min-height: 100vh;
        }
        
        .financial-widget {
            background-color: #ffffff;
            border-radius: 12px;
            box-shadow: 0 10px 30px rgba(0, 0, 0, 0.2);
            width: 100%;
            max-width: 1080px;
            padding: 25px;
            position: relative;
            padding-bottom: 70px;
            overflow: hidden;
        }
        
        .header {
            display: flex;
            justify-content: space-between;
            align-items: center;
            margin-bottom: 25px;
            padding-bottom: 25px;
            border-bottom: 2px solid #f0f2f5;
        }
        
        h1 {
            color: #2c3e50;
            font-size: 1.9em;
            font-weight: 700;
            display: flex;
            align-items: center;
            gap: 10px;
        }
        
        h1 i {
            color: #3498db;
        }
        
        .date-display {
            background: #f8f9fa;
            padding: 8px 20px;
            border-radius: 30px;
            font-weight: 600;
            color: #555;
            box-shadow: 0 2px 5px rgba(0,0,0,0.05);
            font-size: 0.9em;
        }
        
        .input-section {
            display: flex;
            flex-wrap: wrap;
            gap: 20px;
            margin-bottom: 30px;
            align-items: flex-end;
            background: #f8f9fa;
            padding: 25px;
            border-radius: 12px;
        }
        
        .input-group {
            flex: 1;
            min-width: 200px;
        }
        
        .input-group label {
            display: block;
            margin-bottom: 8px;
            color: #555;
            font-weight: 500;
            font-size: 0.95em;
        }
        
        .input-group input, 
        .input-group select {
            width: 100%;
            padding: 14px;
            border: 1px solid #dfe6e9;
            border-radius: 8px;
            font-size: 1em;
            color: #34495e;
            transition: all 0.3s ease;
            background-color: white;
        }
        
        .input-group input:focus,
        .input-group select:focus {
            border-color: #3498db;
            outline: none;
            box-shadow: 0 0 0 3px rgba(52, 152, 219, 0.2);
        }
        
        .input-actions {
            display: flex;
            gap: 10px;
            flex-grow: 1;
            justify-content: flex-end;
            flex-wrap: wrap;
        }
        
        .btn {
            padding: 14px 20px;
            border: none;
            border-radius: 8px;
            font-size: 0.95em;
            cursor: pointer;
            transition: all 0.3s ease;
            font-weight: 600;
            color: white;
            display: flex;
            align-items: center;
            gap: 8px;
            box-shadow: 0 4px 6px rgba(0,0,0,0.1);
        }
        
        .btn-income {
            background: linear-gradient(to right, #27ae60, #2ecc71);
        }
        
        .btn-income:hover {
            transform: translateY(-3px);
            box-shadow: 0 6px 12px rgba(46, 204, 113, 0.3);
        }
        
        .btn-expense {
            background: linear-gradient(to right, #e74c3c, #ff6b6b);
        }
        
        .btn-expense:hover {
            transform: translateY(-3px);
            box-shadow: 0 6px 12px rgba(231, 76, 60, 0.3);
        }
        
        .btn-edit {
            background: linear-gradient(to right, #3498db, #5dade2);
            color: white;
            padding: 8px 15px;
            font-size: 0.9em;
        }
        
        .btn-edit:hover {
            background: linear-gradient(to right, #2980b9, #3498db);
        }
        
        .btn-delete {
            background: linear-gradient(to right, #e74c3c, #ff6b6b);
            color: white;
            padding: 8px 15px;
            font-size: 0.9em;
        }
        
        .btn-delete:hover {
            background: linear-gradient(to right, #c0392b, #e74c3c);
        }
        
        .btn-update {
            background: linear-gradient(to right, #9b59b6, #8e44ad);
        }
        
        .btn-update:hover {
            transform: translateY(-3px);
            box-shadow: 0 6px 12px rgba(155, 89, 182, 0.3);
        }
        
        .btn-cancel {
            background: linear-gradient(to right, #95a5a6, #7f8c8d);
        }
        
        .btn-cancel:hover {
            transform: translateY(-3px);
            box-shadow: 0 6px 12px rgba(149, 165, 166, 0.3);
        }
        
        .btn-image {
            background: linear-gradient(to right, #3498db, #5dade2);
            width: 100%;
            margin-top: 15px;
            padding: 14px;
            font-size: 1.0em;
            justify-content: center;
        }
        
        .btn-image:hover {
            transform: translateY(-3px);
            box-shadow: 0 6px 12px rgba(52, 152, 219, 0.3);
        }
        
        .btn-csv {
            background: linear-gradient(to right, #27ae60, #2ecc71);
            width: 100%;
            margin-top: 15px;
            padding: 14px;
            font-size: 1.0em;
            justify-content: center;
        }
        
        .btn-pdf {
            background: linear-gradient(to right, #e74c3c, #ff6b6b);
            width: 100%;
            margin-top: 15px;
            padding: 14px;
            font-size: 1.0em;
            justify-content: center;
        }
        
        .summary-section {
            display: flex;
            justify-content: space-around;
            background: linear-gradient(135deg, #f5f7fa, #e4e7eb);
            padding: 25px;
            border-radius: 12px;
            margin-bottom: 30px;
            flex-wrap: wrap;
            gap: 20px;
            box-shadow: 0 4px 8px rgba(0,0,0,0.05);
        }
        
        .summary-item {
            text-align: center;
            min-width: 200px;
            flex: 1;
            padding: 15px;
            border-radius: 10px;
            background: white;
            box-shadow: 0 3px 10px rgba(0,0,0,0.08);
        }
        
        .summary-item h3 {
            color: #7f8c8d;
            font-size: 0.95em;
            margin-bottom: 10px;
        }
        
        .summary-item p {
            font-size: 1.5em;
            font-weight: 700;
            margin: 5px 0 0;
        }
        
        #total-income {
            color: #27ae60;
        }
        
        #total-expense {
            color: #e74c3c;
        }
        
        #current-balance {
            color: #3498db; /* Cor azul para o saldo */
        }
        
        #total-paid {
            color: #2c3e50; /* Cor escura para total pago */
        }
        
        #total-pending {
            color: #2c3e50; /* Cor escura para total pendente */
        }
        
        .data-section {
            background: #f8f9fa;
            padding: 20px;
            border-radius: 12px;
            margin-bottom: 30px;
            box-shadow: 0 4px 8px rgba(0,0,0,0.05);
        }
        
        .section-title {
            color: #2c3e50;
            font-size: 1.1em;
            font-weight: 600;
            margin-bottom: 15px;
            display: flex;
            align-items: center;
            gap: 10px;
        }
        
        .data-section table {
            width: 100%;
            border-collapse: collapse;
            margin-top: 15px;
        }
        
        .data-section th,
        .data-section td {
            padding: 12px 10px;
            text-align: center;
            border-bottom: 1px solid #ecf0f1;
            font-size: 0.9em;
        }
        
        .data-section th {
            background-color: #2c3e50;
            color: white;
            font-weight: 500;
            text-transform: uppercase;
            font-size: 0.80em;
        }
        
        .data-section td {
            color: #34495e;
        }
        
        .data-section tbody tr:nth-child(even) {
            background-color: #f8f9fa;
        }
        
        .data-section tbody tr:hover {
            background-color: #f0f7ff;
        }
        
        .type-income {
            color: #27ae60;
            font-weight: 500;
            background: rgba(39, 174, 96, 0.1);
            padding: 5px 10px;
            border-radius: 20px;
            display: inline-block;
            font-size: 0.9em;
        }
        
        .type-expense {
            color: #e74c3c;
            font-weight: 500;
            background: rgba(231, 76, 60, 0.1);
            padding: 5px 10px;
            border-radius: 20px;
            display: inline-block;
            font-size: 0.9em;
        }
        
        .category-badge {
            font-size: 0.8em;
            padding: 4px 8px;
            border-radius: 12px;
            background: #f1f2f6;
            color: #2f3542;
            font-weight: 500;
            display: inline-block;
        }
        
        .charts-section {
            background: #f8f9fa;
            padding: 20px;
            border-radius: 12px;
            box-shadow: 0 4px 8px rgba(0,0,0,0.05);
            margin-bottom: 20px;
        }
        
        .charts-container {
            display: flex;
            flex-wrap: wrap;
            gap: 20px;
            justify-content: center;
            margin-top: 10px;
        }
        
        .chart-container {
            width: 100%;
            max-width: 450px;
            height: 350px;
            background-color: white;
            padding: 20px;
            border-radius: 10px;
            box-shadow: 0 4px 10px rgba(0,0,0,0.08);
        }
        
        .chart-header {
            display: flex;
            justify-content: space-between;
            align-items: center;
            margin-bottom: 10px;
        }
        
        .chart-title {
            color: #2c3e50;
            font-size: 1.0em;
            font-weight: 500;
        }
        
        .chart-actions {
            display: flex;
            gap: 10px;
        }
        
        .chart-btn {
            background: #3498db;
            color: white;
            border: none;
            border-radius: 5px;
            padding: 6px 10px;
            cursor: pointer;
            font-size: 0.85em;
        }
        
        .widget-footer {
            text-align: center;
            margin-top: 30px;
            color: #7f8c8d;
            font-size: 0.9em;
            padding-top: 10px;
            border-top: 1px solid #eee;
            position: absolute;
            bottom: 0;
            left: 0;
            right: 0;
            padding-bottom: 15px;
            background-color: #ffffff;
        }
        
        .edit-mode-banner {
            background: linear-gradient(to right, #9b59b6, #8e44ad);
            color: white;
            padding: 10px;
            text-align: center;
            border-radius: 8px;
            margin-bottom: 15px;
            font-weight: 600;
            display: flex;
            align-items: center;
            justify-content: center;
            gap: 10px;
        }
        
        .action-buttons {
            display: flex;
            gap: 10px;
            justify-content: flex-end;
            width: 100%;
            margin-top: 15px;
        }
        
        .action-cell {
            display: flex;
            gap: 8px;
            justify-content: center;
        }
        
        .error-message {
            color: #e74c3c;
            font-size: 0.8em;
            margin-top: 5px;
            display: none;
        }
        
        .input-group.error input,
        .input-group.error select {
            border-color: #e74c3c;
        }
        
        .export-section {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(250px, 1fr));
            gap: 15px;
            margin-top: 20px;
        }
        
        .export-notification {
            position: fixed;
            top: 20px;
            right: 20px;
            padding: 15px 25px;
            border-radius: 8px;
            background: #2ecc71;
            color: white;
            font-weight: 600;
            box-shadow: 0 5px 15px rgba(0,0,0,0.2);
            z-index: 1000;
            display: none;
            animation: slideIn 0.3s, fadeOut 0.5s 2.5s;
        }
        
        @keyframes slideIn {
            from { right: -300px; opacity: 0; }
            to { right: 20px; opacity: 1; }
        }
        
        @keyframes fadeOut {
            from { opacity: 1; }
            to { opacity: 0; }
        }
        
        /* Melhorias para tabela em dispositivos móveis */
        @media (max-width: 768px) {
            body {
                padding: 10px;
            }
            
            .financial-widget {
                padding: 15px;
                padding-bottom: 100px;
            }
            
            .header {
                flex-direction: column;
                gap: 15px;
                text-align: center;
            }
            
            .input-section {
                flex-direction: column;
                align-items: stretch;
                padding: 15px;
                gap: 15px;
            }
            
            .input-actions {
                flex-direction: column;
                justify-content: center;
                align-items: stretch;
                gap: 10px;
            }
            
            .btn {
                width: 100%;
                padding: 12px 15px;
                font-size: 0.9em;
            }
            
            .summary-section {
                flex-direction: column;
                gap: 15px;
                padding: 15px;
            }
            
            .summary-item {
                min-width: 100%;
                padding: 12px;
            }
            
            .summary-item p {
                font-size: 1.3em;
            }
            
            .charts-container {
                flex-direction: column;
                align-items: center;
                gap: 15px;
            }
            
            .chart-container {
                max-width: 100%;
                height: 300px;
                padding: 15px;
            }
            
            .data-section {
                padding: 15px;
            }
            
            .section-title {
                font-size: 1.0em;
                justify-content: center;
            }
            
            .action-buttons {
                flex-direction: column;
            }
            
            .btn-edit, .btn-delete {
                padding: 8px 10px;
                font-size: 0.85em;
            }
            
            /* Melhorias específicas para a tabela em mobile */
            .data-section table, 
            .data-section thead, 
            .data-section tbody, 
            .data-section th, 
            .data-section td, 
            .data-section tr {
                display: block;
            }
            
            .data-section thead tr {
                position: absolute;
                top: -9999px;
                left: -9999px;
            }
            
            .data-section tr {
                border: 1px solid #ddd;
                margin-bottom: 15px;
                border-radius: 8px;
                overflow: hidden;
                box-shadow: 0 2px 5px rgba(0,0,0,0.1);
                position: relative;
            }
            
            .data-section td {
                border: none;
                border-bottom: 1px solid #eee;
                position: relative;
                padding-left: 50%;
                text-align: right;
                font-size: 0.85em;
                padding: 10px 15px;
            }
            
            .data-section td:last-child {
                border-bottom: 0;
                text-align: center;
                padding-left: 10px;
            }
            
            .data-section td::before {
                content: attr(data-label);
                position: absolute;
                left: 10px;
                width: 45%;
                padding-right: 10px;
                white-space: nowrap;
                text-align: left;
                font-weight: bold;
                color: #555;
                font-size: 0.85em;
            }
            
            /* Remover o label "Paga?" para rendas */
            .data-section td[data-label="Paga?"][data-is-income="true"]::before {
                display: none;
            }
            
            /* Ajuste para botões de ação em mobile */
            .action-cell {
                display: flex;
                justify-content: center;
                gap: 10px;
                padding: 10px 0;
            }
            
            /* Centralizar e organizar os botões */
            .action-cell .btn {
                width: auto;
                padding: 8px 15px;
                font-size: 0.9em;
                display: inline-flex;
            }
            
            /* Esconder o texto dos botões em mobile */
            .action-cell .btn span {
                display: none;
            }
            
            /* Ajuste para tipos de transação em mobile */
            .type-income, .type-expense {
                font-size: 0.9em;
                padding: 4px 8px;
            }
            
            .category-badge {
                font-size: 0.75em;
            }
            
            .export-section {
                grid-template-columns: 1fr;
            }
        }
        
        /* Melhorias adicionais para telas muito pequenas */
        @media (max-width: 480px) {
            h1 {
                font-size: 1.6em;
            }
            
            .date-display {
                font-size: 0.8em;
                padding: 6px 15px;
            }
            
            .input-group input, 
            .input-group select {
                padding: 12px;
            }
            
            .summary-item h3 {
                font-size: 0.9em;
            }
            
            .summary-item p {
                font-size: 1.2em;
            }
            
            .data-section td {
                font-size: 0.8em;
                padding: 10px 15px 10px 50%;
            }
            
            .data-section td::before {
                font-size: 1.0em;
            }
            
            .btn-image, .btn-csv, .btn-pdf {
                padding: 14px;
                font-size: 0.95em;
            }
            
            /* Botões de ação em telas muito pequenas */
            .action-cell .btn {
                padding: 8px 12px;
                font-size: 0.8em;
            }
            
            /* Ícones um pouco menores em telas muito pequenas */
            .action-cell .btn i {
                font-size: 0.9em;
            }
        }
    </style>
</head>
<body>
    <div class="export-notification" id="export-notification">
        <i class="fas fa-check-circle"></i> Arquivo exportado com sucesso!
    </div>
    
    <div class="financial-widget" id="financial-widget-content">
        <div class="header">
            <h1><i class="fas fa-chart-line"></i> Controle Financeiro Pessoal</h1>
            <div class="date-display">
                <i class="fas fa-calendar-alt"></i> <span id="current-date"></span>
            </div>
        </div>

        <div class="input-section">
            <div class="input-group">
                <label for="description"><i class="fas fa-pen"></i> Descrição:</label>
                <input type="text" id="description" placeholder="Ex: Salário, Aluguel" required>
            </div>
            <div class="input-group">
                <label for="value"><i class="fas fa-money-bill-wave"></i> Valor (R$):</label>
                <input type="number" id="value" placeholder="Ex: 1500.00" step="0.01" required>
            </div>
            <div class="input-group">
                <label for="category"><i class="fas fa-tag"></i> Categoria:</label>
                <select id="category" required>
                    <option value="" disabled selected>Selecione uma categoria</option>
                    <!-- As categorias serão preenchidas via JavaScript -->
                </select>
                <div class="error-message" id="category-error">Selecione uma categoria válida para este tipo de transação</div>
            </div>
            <div class="input-actions">
                <button id="add-income" class="btn btn-income">
                    <i class="fas fa-plus-circle"></i> Adicionar Renda
                </button>
                <button id="add-expense" class="btn btn-expense">
                    <i class="fas fa-minus-circle"></i> Adicionar Despesa
                </button>
            </div>
            
            <!-- Área para botões de atualização/cancelamento (inicialmente oculta) -->
            <div id="edit-mode-section" class="action-buttons" style="display: none;">
                <button id="update-transaction" class="btn btn-update">
                    <i class="fas fa-save"></i> Atualizar Transação
                </button>
                <button id="cancel-edit" class="btn btn-cancel">
                    <i class="fas fa-times"></i> Cancelar Edição
                </button>
            </div>
        </div>

        <div class="summary-section">
            <div class="summary-item">
                <h3><i class="fas fa-arrow-up"></i> Renda Total:</h3>
                <p id="total-income">R$ 0.00</p>
            </div>
            <div class="summary-item">
                <h3><i class="fas fa-arrow-down"></i> Despesa Total:</h3>
                <p id="total-expense">R$ 0.00</p>
            </div>
            <div class="summary-item">
                <h3><i class="fas fa-balance-scale"></i> Saldo Atual:</h3>
                <p id="current-balance">R$ 0.00</p>
            </div>
            <div class="summary-item">
                <h3><i class="fas fa-check-circle"></i> Total Pago:</h3>
                <p id="total-paid">R$ 0.00</p>
            </div>
            <div class="summary-item">
                <h3><i class="fas fa-clock"></i> Total Pendente:</h3>
                <p id="total-pending">R$ 0.00</p>
            </div>
        </div>

        <div class="data-section">
            <div class="section-title"><i class="fas fa-list"></i> Detalhes das Transações</div>
            <table id="transactions-table">
                <thead>
                    <tr>
                        <th>Tipo</th>
                        <th>Descrição</th>
                        <th>Categoria</th>
                        <th>Valor</th>
                        <th>Paga?</th>
                        <th>Ações</th>
                    </tr>
                </thead>
                <tbody>
                </tbody>
            </table>
        </div>

        <div class="charts-section">
            <div class="section-title"><i class="fas fa-chart-pie"></i> Gráficos de Finanças</div>
            <div class="charts-container">
                <div class="chart-container">
                    <div class="chart-header">
                        <div class="chart-title">Distribuição de Despesas</div>
                    </div>
                    <canvas id="expense-chart"></canvas>
                </div>
                <div class="chart-container">
                    <div class="chart-header">
                        <div class="chart-title">Análise Percentual</div>
                    </div>
                    <canvas id="summary-chart"></canvas>
                </div>
            </div>
        </div>

        <div class="export-section">
            <button id="generate-image" class="btn btn-image">
                <i class="fas fa-camera"></i> Gerar Imagem do Relatório
            </button>
            <button id="export-csv" class="btn btn-csv">
                <i class="fas fa-file-csv"></i> Exportar para Planilha (CSV)
            </button>
            <button id="export-pdf" class="btn btn-pdf">
                <i class="fas fa-file-pdf"></i> Exportar para PDF
            </button>
        </div>

        <div class="widget-footer">
            Guilherme S. Vanderley © 2025 - Todos os direitos reservados.
        </div>
    </div>

    <script>
        // Referências aos elementos do DOM
        const descriptionInput = document.getElementById('description');
        const valueInput = document.getElementById('value');
        const categoryInput = document.getElementById('category');
        const addIncomeBtn = document.getElementById('add-income');
        const addExpenseBtn = document.getElementById('add-expense');
        const totalIncomeElem = document.getElementById('total-income');
        const totalExpenseElem = document.getElementById('total-expense');
        const currentBalanceElem = document.getElementById('current-balance');
        const totalPaidElem = document.getElementById('total-paid');
        const totalPendingElem = document.getElementById('total-pending');
        const transactionsTableBody = document.querySelector('#transactions-table tbody');
        const generateImageBtn = document.getElementById('generate-image');
        const exportCsvBtn = document.getElementById('export-csv');
        const exportPdfBtn = document.getElementById('export-pdf');
        const expenseChartCanvas = document.getElementById('expense-chart').getContext('2d');
        const summaryChartCanvas = document.getElementById('summary-chart').getContext('2d');
        const financialWidgetContent = document.getElementById('financial-widget-content');
        const currentDateElem = document.getElementById('current-date');
        const updateBtn = document.getElementById('update-transaction');
        const cancelBtn = document.getElementById('cancel-edit');
        const editModeSection = document.getElementById('edit-mode-section');
        const categoryError = document.getElementById('category-error');
        const exportNotification = document.getElementById('export-notification');
        
        // Atualizar data atual
        const now = new Date();
        currentDateElem.textContent = now.toLocaleDateString('pt-BR', { 
            weekday: 'long', 
            year: 'numeric', 
            month: 'long', 
            day: 'numeric' 
        });

        // Categorias pré-definidas
        const incomeCategories = ["Salário", "Freelance", "Investimentos", "Presente", "Outros"];
        const expenseCategories = ["Moradia", "Alimentação", "Transporte", "Lazer", "Saúde", "Educação", "Outros"];
        
        // Preencher o select de categorias com grupos
        function populateCategories() {
            categoryInput.innerHTML = '<option value="" disabled selected>Selecione uma categoria</option>';
            
            // Grupo de Renda
            const incomeGroup = document.createElement('optgroup');
            incomeGroup.label = 'Renda';
            incomeCategories.forEach(category => {
                const option = document.createElement('option');
                option.value = category;
                option.textContent = category;
                incomeGroup.appendChild(option);
            });
            categoryInput.appendChild(incomeGroup);
            
            // Grupo de Despesas
            const expenseGroup = document.createElement('optgroup');
            expenseGroup.label = 'Despesas';
            expenseCategories.forEach(category => {
                const option = document.createElement('option');
                option.value = category;
                option.textContent = category;
                expenseGroup.appendChild(option);
            });
            categoryInput.appendChild(expenseGroup);
        }
        
        // Inicialmente preencher com todas as categorias
        populateCategories();

        // Variáveis globais para armazenar os dados
        let transactions = [];
        let expenseChart;
        let summaryChart;
        let isEditMode = false;
        let currentEditId = null;
        let currentTransactionType = null;

        // --- Funções Principais ---

        // Carrega as transações do Local Storage ao iniciar
        function loadTransactions() {
            const storedTransactions = localStorage.getItem('financialTransactions');
            if (storedTransactions) {
                transactions = JSON.parse(storedTransactions);
                
                // Inicializar propriedade 'paga' para transações antigas
                transactions.forEach(transaction => {
                    if (transaction.type === 'expense' && transaction.paga === undefined) {
                        transaction.paga = false;
                    }
                });
            }
            updateUI();
        }

        // Salva as transações no Local Storage
        function saveTransactions() {
            localStorage.setItem('financialTransactions', JSON.stringify(transactions));
        }

        // Valida se a categoria é compatível com o tipo de transação
        function validateCategory(type, category) {
            if (type === 'income') {
                return incomeCategories.includes(category);
            } else {
                return expenseCategories.includes(category);
            }
        }

        // Mostra mensagem de erro na categoria
        function showCategoryError(message) {
            categoryError.textContent = message;
            categoryError.style.display = 'block';
            categoryInput.parentElement.classList.add('error');
        }

        // Esconde a mensagem de erro na categoria
        function hideCategoryError() {
            categoryError.style.display = 'none';
            categoryInput.parentElement.classList.remove('error');
        }

        // Adiciona uma nova transação
        function addTransaction(type) {
            const description = descriptionInput.value.trim();
            const value = parseFloat(valueInput.value);
            const category = categoryInput.value;
            
            // Resetar mensagens de erro
            hideCategoryError();

            if (!description || isNaN(value) || value <= 0 || !category) {
                alert('Por favor, preencha todos os campos com valores válidos.');
                return;
            }
            
            // Validar categoria compatível com o tipo
            if (!validateCategory(type, category)) {
                let message = '';
                if (type === 'income') {
                    message = 'Selecione uma categoria de renda válida';
                } else {
                    message = 'Selecione uma categoria de despesa válida';
                }
                showCategoryError(message);
                return;
            }

            const transaction = {
                id: Date.now(), // ID único para a transação
                description,
                category,
                value: type === 'expense' ? -value : value,
                type,
                // Para despesas, inicializar como não paga
                ...(type === 'expense' && { paga: false })
            };

            transactions.push(transaction);
            saveTransactions();
            updateUI();
            clearInputs();
        }

        // Atualiza uma transação existente
        function updateTransaction() {
            const description = descriptionInput.value.trim();
            const value = parseFloat(valueInput.value);
            const category = categoryInput.value;
            
            // Resetar mensagens de erro
            hideCategoryError();

            if (!description || isNaN(value) || value <= 0 || !category) {
                alert('Por favor, preencha todos os campos com valores válidos.');
                return;
            }
            
            // Validar categoria compatível com o tipo
            if (!validateCategory(currentTransactionType, category)) {
                let message = '';
                if (currentTransactionType === 'income') {
                    message = 'Selecione uma categoria de renda válida';
                } else {
                    message = 'Selecione uma categoria de despesa válida';
                }
                showCategoryError(message);
                return;
            }

            // Encontra o índice da transação sendo editada
            const index = transactions.findIndex(t => t.id === currentEditId);
            
            if (index !== -1) {
                transactions[index].description = description;
                transactions[index].value = currentTransactionType === 'expense' ? -value : value;
                transactions[index].category = category;
                
                saveTransactions();
                updateUI();
                cancelEditMode();
            }
        }

        // Remove uma transação
        function deleteTransaction(id) {
            if (confirm('Tem certeza que deseja excluir esta transação?')) {
                transactions = transactions.filter(transaction => transaction.id !== id);
                saveTransactions();
                updateUI();
            }
        }

        // Ativa o modo de edição
        function activateEditMode(id) {
            const transaction = transactions.find(t => t.id === id);
            
            if (transaction) {
                isEditMode = true;
                currentEditId = id;
                currentTransactionType = transaction.type;
                
                // Preencher os campos com os dados da transação
                descriptionInput.value = transaction.description;
                valueInput.value = Math.abs(transaction.value);
                categoryInput.value = transaction.category;
                
                // Mostrar botões de atualização/cancelamento
                editModeSection.style.display = 'flex';
                
                // Rolar até o formulário
                descriptionInput.scrollIntoView({ behavior: 'smooth', block: 'center' });
            }
        }

        // Cancela o modo de edição
        function cancelEditMode() {
            isEditMode = false;
            currentEditId = null;
            currentTransactionType = null;
            editModeSection.style.display = 'none';
            clearInputs();
            hideCategoryError();
        }

        // Atualiza a interface do usuário (tabela, resumos e gráficos)
        function updateUI() {
            updateSummary();
            renderTransactionsTable();
            updateCharts();
        }

        // Atualiza os totais de renda, despesa e saldo
        function updateSummary() {
            let totalIncome = 0;
            let totalExpense = 0;
            let totalPaid = 0;
            let totalPending = 0;

            transactions.forEach(transaction => {
                if (transaction.type === 'income') {
                    totalIncome += transaction.value;
                } else {
                    const expenseValue = Math.abs(transaction.value);
                    totalExpense += expenseValue;
                    
                    if (transaction.paga) {
                        totalPaid += expenseValue;
                    } else {
                        totalPending += expenseValue;
                    }
                }
            });

            const currentBalance = totalIncome - totalExpense;

            totalIncomeElem.textContent = formatCurrency(totalIncome);
            totalExpenseElem.textContent = formatCurrency(totalExpense);
            currentBalanceElem.textContent = formatCurrency(currentBalance);
            totalPaidElem.textContent = formatCurrency(totalPaid);
            totalPendingElem.textContent = formatCurrency(totalPending);
        }

        // Renderiza as transações na tabela
        function renderTransactionsTable() {
            transactionsTableBody.innerHTML = '';

            // Ordenar transações por data (mais recentes primeiro)
            const sortedTransactions = [...transactions].sort((a, b) => b.id - a.id);

            sortedTransactions.forEach(transaction => {
                const row = transactionsTableBody.insertRow();
                
                // Tipo
                const typeCell = row.insertCell();
                typeCell.innerHTML = `<span class="${transaction.type === 'income' ? 'type-income' : 'type-expense'}">${transaction.type === 'income' ? 'Renda' : 'Despesa'}</span>`;
                typeCell.setAttribute('data-label', 'Tipo');

                // Descrição
                const descriptionCell = row.insertCell();
                descriptionCell.textContent = transaction.description;
                descriptionCell.setAttribute('data-label', 'Descrição');
                
                // Categoria
                const categoryCell = row.insertCell();
                categoryCell.innerHTML = `<span class="category-badge">${transaction.category}</span>`;
                categoryCell.setAttribute('data-label', 'Categoria');

                // Valor
                const valueCell = row.insertCell();
                valueCell.textContent = formatCurrency(Math.abs(transaction.value));
                valueCell.setAttribute('data-label', 'Valor');

                // Paga? (apenas para despesas)
                const paidCell = row.insertCell();
                if (transaction.type === 'expense') {
                    paidCell.setAttribute('data-label', 'Paga?');
                    paidCell.setAttribute('data-is-income', 'false');
                    
                    const checkbox = document.createElement('input');
                    checkbox.type = 'checkbox';
                    checkbox.checked = transaction.paga || false;
                    checkbox.addEventListener('change', () => {
                        transaction.paga = checkbox.checked;
                        saveTransactions();
                        updateUI();
                    });
                    paidCell.appendChild(checkbox);
                } else {
                    paidCell.setAttribute('data-label', 'Paga?');
                    paidCell.setAttribute('data-is-income', 'true');
                    paidCell.textContent = '-';
                }

                // Ações
                const actionsCell = row.insertCell();
                actionsCell.setAttribute('data-label', 'Ações');
                actionsCell.className = 'action-cell';
                
                const editBtn = document.createElement('button');
                editBtn.innerHTML = '<i class="fas fa-edit"></i> <span>Editar</span>';
                editBtn.classList.add('btn', 'btn-edit');
                editBtn.onclick = () => activateEditMode(transaction.id);
                
                const deleteBtn = document.createElement('button');
                deleteBtn.innerHTML = '<i class="fas fa-trash-alt"></i> <span>Excluir</span>';
                deleteBtn.classList.add('btn', 'btn-delete');
                deleteBtn.onclick = () => deleteTransaction(transaction.id);
                
                actionsCell.appendChild(editBtn);
                actionsCell.appendChild(deleteBtn);
            });
        }

        // Atualiza os gráficos
        function updateCharts() {
            // Calcular valores para os gráficos
            const expenseByCategory = {};
            let totalIncome = 0;
            let totalExpense = 0;
            
            transactions.forEach(t => {
                if (t.type === 'income') {
                    totalIncome += t.value;
                } else {
                    totalExpense += Math.abs(t.value);
                    
                    // Agrupar despesas por categoria
                    expenseByCategory[t.category] = (expenseByCategory[t.category] || 0) + Math.abs(t.value);
                }
            });
            
            const currentBalance = totalIncome - totalExpense;
            
            // Calcular porcentagens para o gráfico de barras
            const incomePercent = totalIncome > 0 ? 100 : 0;
            const expensePercent = totalIncome > 0 ? (totalExpense / totalIncome) * 100 : 0;
            const balancePercent = totalIncome > 0 ? (currentBalance / totalIncome) * 100 : 0;
            
            // Atualizar gráfico de despesas
            updateExpenseChart(Object.keys(expenseByCategory), Object.values(expenseByCategory));
            
            // Atualizar gráfico de porcentagens
            updateSummaryChart(incomePercent, expensePercent, balancePercent);
        }

        // Atualizar gráfico de despesas (pizza)
        function updateExpenseChart(labels, data) {
            if (expenseChart) {
                expenseChart.destroy();
            }
            
            // Se não houver despesas, exibir mensagem
            if (data.length === 0) {
                expenseChart = new Chart(expenseChartCanvas, {
                    type: 'doughnut',
                    data: {
                        datasets: [{
                            data: [1],
                            backgroundColor: ['#f0f0f0']
                        }]
                    },
                    options: {
                        responsive: true,
                        maintainAspectRatio: false,
                        plugins: {
                            legend: { display: false },
                            tooltip: { enabled: false },
                            beforeDraw: function(chart) {
                                const ctx = chart.ctx;
                                const width = chart.width;
                                const height = chart.height;
                                
                                ctx.restore();
                                ctx.font = "16px 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif";
                                ctx.textAlign = 'center';
                                ctx.textBaseline = 'middle';
                                ctx.fillStyle = '#7f8c8d';
                                ctx.fillText('Nenhuma despesa registrada', width / 2, height / 2);
                                ctx.save();
                            }
                        }
                    }
                });
                return;
            }

            expenseChart = new Chart(expenseChartCanvas, {
                type: 'doughnut',
                data: {
                    labels: labels,
                    datasets: [{
                        data: data,
                        backgroundColor: [
                            '#FF6384', '#36A2EB', '#FFCE56', '#4BC0C0', '#9966FF', '#FF9F40',
                            '#8D6E63', '#4DD0E1', '#F44336', '#9C27B0'
                        ],
                        hoverOffset: 4
                    }]
                },
                options: {
                    responsive: true,
                    maintainAspectRatio: false,
                    plugins: {
                        legend: {
                            position: 'right',
                            labels: {
                                font: {
                                    size: 11
                                },
                                color: '#555'
                            }
                        },
                        tooltip: {
                            callbacks: {
                                label: function(context) {
                                    let label = context.label || '';
                                    if (label) {
                                        label += ': ';
                                    }
                                    if (context.parsed !== null) {
                                        label += formatCurrency(context.parsed);
                                    }
                                    return label;
                                }
                            }
                        }
                    }
                }
            });
        }

        // Atualizar gráfico de porcentagens (barras horizontais)
        function updateSummaryChart(incomePercent, expensePercent, balancePercent) {
            if (summaryChart) {
                summaryChart.destroy();
            }

            summaryChart = new Chart(summaryChartCanvas, {
                type: 'bar',
                data: {
                    labels: ['Rendas', 'Gastos', 'Saldo'],
                    datasets: [{
                        label: 'Porcentagem em relação à renda total',
                        data: [incomePercent, expensePercent, balancePercent],
                        backgroundColor: [
                            'rgba(39, 174, 96, 0.7)',   // Verde para rendas
                            'rgba(231, 76, 60, 0.7)',   // Vermelho para gastos
                            'rgba(52, 152, 219, 0.7)'   // Azul para saldo
                        ],
                        borderColor: [
                            'rgba(39, 174, 96, 1)',
                            'rgba(231, 76, 60, 1)',
                            'rgba(52, 152, 219, 1)'
                        ],
                        borderWidth: 1
                    }]
                },
                options: {
                    indexAxis: 'y',
                    responsive: true,
                    maintainAspectRatio: false,
                    plugins: {
                        tooltip: {
                            callbacks: {
                                label: function(context) {
                                    return `${context.parsed.x.toFixed(1)}%`;
                                }
                            }
                        }
                    },
                    scales: {
                        x: {
                            beginAtZero: true,
                            max: 100,
                            title: {
                                display: true,
                                text: 'Porcentagem (%)',
                                font: {
                                    size: 14
                                }
                            },
                            ticks: {
                                callback: function(value) {
                                    return value + '%';
                                }
                            }
                        }
                    }
                }
            });
        }

        // Limpa os campos de entrada
        function clearInputs() {
            descriptionInput.value = '';
            valueInput.value = '';
            categoryInput.value = '';
            descriptionInput.focus();
            hideCategoryError();
        }

        // Formata o valor para moeda brasileira
        function formatCurrency(value) {
            return value.toLocaleString('pt-BR', { 
                style: 'currency', 
                currency: 'BRL',
                minimumFractionDigits: 2,
                maximumFractionDigits: 2
            });
        }
        
        // Formata o valor para CSV (sem símbolo de moeda)
        function formatCurrencyForCSV(value) {
            return value.toLocaleString('pt-BR', { 
                minimumFractionDigits: 2,
                maximumFractionDigits: 2
            });
        }

        // Geração de imagem
        async function generateImage() {
            try {
                const canvas = await html2canvas(financialWidgetContent, {
                    scale: 2,
                    useCORS: true,
                    logging: false
                });

                const image = canvas.toDataURL('image/png');
                const link = document.createElement('a');
                link.href = image;
                link.download = 'relatorio_financeiro.png';
                document.body.appendChild(link);
                link.click();
                document.body.removeChild(link);
                
                showExportNotification();
            } catch (error) {
                console.error("Erro ao gerar imagem:", error);
                alert('Ocorreu um erro ao gerar a imagem. Tente novamente.');
            }
        }
        
        // Exportar para CSV com organização correta
        function exportToCSV() {
            // Verificar se existem transações
            if (transactions.length === 0) {
                alert('Não há transações para exportar!');
                return;
            }
            
            // Cabeçalho do CSV com colunas organizadas
            let csvContent = "Tipo;Descrição;Categoria;Valor;Paga?\n";
            
            // Ordenar transações por data (mais recentes primeiro)
            const sortedTransactions = [...transactions].sort((a, b) => b.id - a.id);
            
            // Adicionar cada transação
            sortedTransactions.forEach(transaction => {
                const type = transaction.type === 'income' ? 'Renda' : 'Despesa';
                // Remover quebras de linha e ponto-e-vírgula para evitar problemas
                const description = transaction.description.replace(/[\n;]/g, ' '); 
                const category = transaction.category;
                const value = formatCurrencyForCSV(Math.abs(transaction.value));
                // Apenas despesas têm informação de pagamento
                const paid = transaction.type === 'expense' ? (transaction.paga ? 'Sim' : 'Não') : '';
                
                // Adicionar linha ao CSV usando ponto-e-vírgula como separador
                csvContent += `${type};"${description}";${category};${value};${paid}\n`;
            });
            
            // Adicionar resumo financeiro
            let totalIncome = 0;
            let totalExpense = 0;
            let totalPaid = 0;
            let totalPending = 0;
            
            transactions.forEach(transaction => {
                if (transaction.type === 'income') {
                    totalIncome += transaction.value;
                } else {
                    const expenseValue = Math.abs(transaction.value);
                    totalExpense += expenseValue;
                    
                    if (transaction.paga) {
                        totalPaid += expenseValue;
                    } else {
                        totalPending += expenseValue;
                    }
                }
            });
            
            const currentBalance = totalIncome - totalExpense;
            
            csvContent += "\n;;;;\n";
            csvContent += `Resumo Financeiro;;;;\n`;
            csvContent += `Renda Total;;;${formatCurrencyForCSV(totalIncome)}\n`;
            csvContent += `Despesa Total;;;${formatCurrencyForCSV(totalExpense)}\n`;
            csvContent += `Total Pago;;;${formatCurrencyForCSV(totalPaid)}\n`;
            csvContent += `Total Pendente;;;${formatCurrencyForCSV(totalPending)}\n`;
            csvContent += `Saldo Atual;;;${formatCurrencyForCSV(currentBalance)}\n`;
            
            // Criar link de download
            const blob = new Blob(["\uFEFF" + csvContent], { type: 'text/csv;charset=utf-8;' });
            const link = document.createElement('a');
            const url = URL.createObjectURL(blob);
            link.setAttribute('href', url);
            link.setAttribute('download', 'transacoes_financeiras.csv');
            link.style.visibility = 'hidden';
            document.body.appendChild(link);
            link.click();
            document.body.removeChild(link);
            
            showExportNotification();
        }
        
        // Exportar para PDF com organização profissional
        async function exportToPDF() {
            try {
                // Verificar se existem transações
                if (transactions.length === 0) {
                    alert('Não há transações para exportar!');
                    return;
                }
                
                // Criar novo documento PDF
                const { jsPDF } = window.jspdf;
                const pdf = new jsPDF('p', 'mm', 'a4');
                
                // Configurações iniciais
                const margin = 15;
                const pageWidth = pdf.internal.pageSize.getWidth();
                const pageHeight = pdf.internal.pageSize.getHeight();
                let yPos = margin;
                
                // Adicionar título com fundo colorido
                pdf.setFillColor(44, 62, 80); // Cor de fundo: #2c3e50
                pdf.rect(0, 0, pageWidth, 30, 'F');
                
                pdf.setFontSize(20);
                pdf.setFont('helvetica', 'bold');
                pdf.setTextColor(255, 255, 255); // Texto branco
                pdf.text('Relatório Financeiro', pageWidth / 2, 20, { align: 'center' });
                yPos = 35;
                
                // Adicionar data
                pdf.setFontSize(12);
                pdf.setFont('helvetica', 'normal');
                pdf.setTextColor(100, 100, 100); // Texto cinza
                pdf.text(`Data: ${new Date().toLocaleDateString('pt-BR')}`, pageWidth / 2, yPos, { align: 'center' });
                yPos += 15;
                
                // Adicionar resumo com fundo
                pdf.setFillColor(245, 247, 250); // Cor de fundo clara
                pdf.rect(margin - 5, yPos - 5, pageWidth - margin*2 + 10, 100, 'F');
                
                pdf.setFontSize(16);
                pdf.setFont('helvetica', 'bold');
                pdf.setTextColor(44, 62, 80); // Texto escuro
                pdf.text('Resumo Financeiro', margin, yPos);
                yPos += 10;
                
                // Calcular totais
                let totalIncome = 0;
                let totalExpense = 0;
                let totalPaid = 0;
                let totalPending = 0;
                
                transactions.forEach(transaction => {
                    if (transaction.type === 'income') {
                        totalIncome += transaction.value;
                    } else {
                        const expenseValue = Math.abs(transaction.value);
                        totalExpense += expenseValue;
                        
                        if (transaction.paga) {
                            totalPaid += expenseValue;
                        } else {
                            totalPending += expenseValue;
                        }
                    }
                });
                
                const currentBalance = totalIncome - totalExpense;
                const expensePercent = totalIncome > 0 ? (totalExpense / totalIncome) * 100 : 0;
                const balancePercent = totalIncome > 0 ? (currentBalance / totalIncome) * 100 : 0;
                
                // Adicionar valores
                pdf.setFontSize(12);
                pdf.setFont('helvetica', 'normal');
                pdf.text(`Renda Total: ${formatCurrency(totalIncome)}`, margin, yPos);
                yPos += 8;
                pdf.text(`Despesa Total: ${formatCurrency(totalExpense)} (${expensePercent.toFixed(1)}%)`, margin, yPos);
                yPos += 8;
                pdf.text(`Total Pago: ${formatCurrency(totalPaid)}`, margin, yPos);
                yPos += 8;
                pdf.text(`Total Pendente: ${formatCurrency(totalPending)}`, margin, yPos);
                yPos += 8;
                pdf.text(`Saldo Atual: ${formatCurrency(currentBalance)} (${balancePercent.toFixed(1)}%)`, margin, yPos);
                yPos += 15;
                
                // Adicionar transações
                pdf.setFontSize(16);
                pdf.setFont('helvetica', 'bold');
                pdf.text('Transações', margin, yPos);
                yPos += 10;
                
                // Cabeçalho da tabela
                pdf.setFontSize(12);
                pdf.setFont('helvetica', 'bold');
                pdf.setFillColor(44, 62, 80); // Cor de fundo escura
                
                // Posições ajustadas para caber no A4
                const col1 = margin;          // Tipo (20mm)
                const col2 = margin + 22;      // Descrição (70mm)
                const col3 = margin + 92;      // Categoria (30mm)
                const col4 = margin + 122;     // Valor (30mm)
                const col5 = margin + 152;     // Paga? (20mm)
                
                // Desenhar fundo do cabeçalho
                pdf.rect(margin - 2, yPos - 2, pageWidth - margin*2 + 4, 10, 'F');
                
                pdf.setTextColor(255, 255, 255); // Texto branco
                pdf.text('Tipo', col1, yPos + 6);
                pdf.text('Descrição', col2, yPos + 6);
                pdf.text('Categoria', col3, yPos + 6);
                pdf.text('Valor', col4, yPos + 6);
                pdf.text('Paga?', col5, yPos + 6);
                yPos += 12;
                
                // Adicionar transações
                pdf.setFontSize(10);
                pdf.setFont('helvetica', 'normal');
                pdf.setTextColor(0, 0, 0); // Texto preto
                
                // Ordenar transações por data (mais recentes primeiro)
                const sortedTransactions = [...transactions].sort((a, b) => b.id - a.id);
                
                let rowCount = 0;
                
                sortedTransactions.forEach(transaction => {
                    // Verificar se precisa de nova página
                    if (yPos > pageHeight - 30) {
                        pdf.addPage();
                        yPos = margin;
                        
                        // Adicionar cabeçalho novamente na nova página
                        pdf.setFontSize(12);
                        pdf.setFont('helvetica', 'bold');
                        pdf.setFillColor(44, 62, 80);
                        pdf.rect(margin - 2, yPos - 2, pageWidth - margin*2 + 4, 10, 'F');
                        pdf.setTextColor(255, 255, 255);
                        pdf.text('Tipo', col1, yPos + 6);
                        pdf.text('Descrição', col2, yPos + 6);
                        pdf.text('Categoria', col3, yPos + 6);
                        pdf.text('Valor', col4, yPos + 6);
                        pdf.text('Paga?', col5, yPos + 6);
                        yPos += 12;
                        pdf.setFontSize(10);
                        pdf.setFont('helvetica', 'normal');
                        pdf.setTextColor(0, 0, 0);
                        rowCount = 0;
                    }
                    
                    const type = transaction.type === 'income' ? 'Renda' : 'Despesa';
                    const description = transaction.description;
                    const category = transaction.category;
                    const value = formatCurrency(Math.abs(transaction.value));
                    // Apenas despesas têm informação de pagamento
                    const paid = transaction.type === 'expense' ? (transaction.paga ? 'Sim' : 'Não') : '';
                    
                    // Alternar cores de fundo
                    if (rowCount % 2 === 0) {
                        pdf.setFillColor(248, 249, 250); // Fundo claro
                    } else {
                        pdf.setFillColor(255, 255, 255); // Fundo branco
                    }
                    
                    // Quebrar descrição longa em múltiplas linhas
                    const maxDescWidth = 70; // Largura máxima da descrição em mm
                    const descLines = pdf.splitTextToSize(description, maxDescWidth);
                    
                    // Calcular altura necessária para esta linha
                    const lineHeight = 8;
                    const cellHeight = Math.max(10, descLines.length * lineHeight);
                    
                    // Desenhar fundo da linha
                    pdf.rect(margin - 2, yPos - 2, pageWidth - margin*2 + 4, cellHeight, 'F');
                    
                    // Escrever tipo
                    pdf.text(type, col1, yPos + (cellHeight/2) - 2);
                    
                    // Escrever descrição (com quebra de linha)
                    let descY = yPos;
                    for (let i = 0; i < descLines.length; i++) {
                        pdf.text(descLines[i], col2, descY);
                        descY += lineHeight;
                    }
                    
                    // Escrever categoria
                    pdf.text(category, col3, yPos + (cellHeight/2) - 2);
                    
                    // Escrever valor
                    pdf.text(value, col4, yPos + (cellHeight/2) - 2);
                    
                    // Escrever status de pagamento
                    pdf.text(paid, col5, yPos + (cellHeight/2) - 2);
                    
                    // Linha divisória
                    pdf.setDrawColor(200, 200, 200);
                    pdf.setLineWidth(0.2);
                    pdf.line(margin, yPos + cellHeight, pageWidth - margin, yPos + cellHeight);
                    
                    yPos += cellHeight + 2;
                    rowCount++;
                });
                
                // Salvar o PDF
                pdf.save('relatorio_financeiro.pdf');
                
                showExportNotification();
            } catch (error) {
                console.error("Erro ao gerar PDF:", error);
                alert('Ocorreu um erro ao gerar o PDF. Tente novamente.');
            }
        }
        
        // Mostrar notificação de exportação
        function showExportNotification() {
            exportNotification.style.display = 'block';
            setTimeout(() => {
                exportNotification.style.display = 'none';
            }, 3000);
        }

        // --- Event Listeners ---
        addIncomeBtn.addEventListener('click', () => {
            addTransaction('income');
        });
        
        addExpenseBtn.addEventListener('click', () => {
            addTransaction('expense');
        });
        
        generateImageBtn.addEventListener('click', generateImage);
        exportCsvBtn.addEventListener('click', exportToCSV);
        exportPdfBtn.addEventListener('click', exportToPDF);
        updateBtn.addEventListener('click', updateTransaction);
        cancelBtn.addEventListener('click', cancelEditMode);
        
        // Ao mudar a categoria, esconder qualquer erro
        categoryInput.addEventListener('change', hideCategoryError);

        // Adicionar transações de exemplo
        function addSampleData() {
            if (transactions.length === 0) {
                transactions = [
                    { id: Date.now(), description: "Salário", category: "Salário", value: 5000, type: "income" },
                    { id: Date.now(), description: "Freelance", category: "Freelance", value: 1500, type: "income" },
                    { id: Date.now(), description: "Aluguel", category: "Moradia", value: -1200, type: "expense", paga: false },
                    { id: Date.now(), description: "Supermercado", category: "Alimentação", value: -450, type: "expense", paga: true },
                    { id: Date.now(), description: "Transporte", category: "Transporte", value: -300, type: "expense", paga: false },
                    { id: Date.now(), description: "Cinema", category: "Lazer", value: -150, type: "expense", paga: true }
                ];
                saveTransactions();
                updateUI();
            }
        }

        // Carrega as transações e atualiza a UI ao carregar a página
        document.addEventListener('DOMContentLoaded', () => {
            loadTransactions();
            addSampleData();
        });
    </script>
</body>
</html>
